# M√≥dulo: Centro de Comando

## Funcionalidade

M√≥dulo dedicado para intera√ß√£o natural com o sistema via IA. O advogado conversa, consulta, executa a√ß√µes e analisa dados sem precisar navegar por m√∫ltiplas telas. Um hub centralizado onde linguagem natural se transforma em a√ß√µes concretas.

### Layout da Tela

**Estrutura em 2 √Åreas Principais:**

**√Årea Superior (60% altura): Conversa√ß√£o**
- Chat completo com hist√≥rico
- Input de texto com sugest√µes inteligentes
- Bot√µes de a√ß√£o r√°pida contextuais
- Mensagens da IA com formata√ß√£o rica
- Possibilidade de anexar arquivos/imagens
- Entrada por voz (opcional)
- Bot√µes: [Limpar Conversa] [Ver Hist√≥rico] [Favoritos]

**√Årea Inferior (40% altura): Resultados**
- Visualiza√ß√£o din√¢mica dos resultados
- Tabs de visualiza√ß√£o: Tabela | Cards | Timeline | Gr√°ficos
- A√ß√µes contextuais sobre os resultados
- Exporta√ß√£o (CSV, PDF, Excel)
- Bot√µes de a√ß√£o r√°pida nos itens
- Scroll independente da conversa

**Sidebar Lateral (colaps√°vel):**
- Seletor de contexto (m√≥dulo alvo)
- Comandos r√°pidos favoritos
- Hist√≥rico de comandos recentes
- Templates de comandos comuns

### Funcionalidades Principais

**1. Seletor de Contexto**

Dropdown no topo para focar a IA em m√≥dulos espec√≠ficos:
- Tudo (contexto geral)
- Processos
- Clientes
- Agenda
- Financeiro
- Publica√ß√µes
- Consultivo
- Documentos
- Relat√≥rios

**Benef√≠cio:** Respostas mais precisas e a√ß√µes direcionadas

**2. Tipos de Comandos Suportados**

**CONSULTAS (Read)**
Buscar e visualizar informa√ß√µes:
- "Mostre processos com prazo esta semana"
- "Quais clientes est√£o inadimplentes?"
- "Quanto recebi este m√™s?"
- "Onde est√° o contrato do cliente Jo√£o Silva?"
- "Minha agenda de amanh√£"
- "Liste publica√ß√µes n√£o lidas"
- "Processos do cliente X"
- "Horas n√£o faturadas do m√™s"

**A√á√ïES (Create/Update)**
Executar opera√ß√µes no sistema:
- "Registrar 2.5h no processo #1234 - an√°lise contratual"
- "Faturar horas do cliente Jo√£o Silva"
- "Agendar reuni√£o com Maria para sexta √†s 14h"
- "Lan√ßar etapa inicial do processo #5678"
- "Marcar publica√ß√£o #789 como lida"
- "Criar novo cliente: Empresa ABC"
- "Atualizar status do processo para suspenso"
- "Enviar cobran√ßa para cliente inadimplente"

**AN√ÅLISES (Insights)**
Gerar an√°lises e insights:
- "Analise performance da equipe este m√™s"
- "Qual √°rea est√° mais rent√°vel?"
- "Clientes sem contato h√° mais de 60 dias"
- "Processos parados h√° muito tempo"
- "Taxa de √™xito em processos trabalhistas"
- "Compare receita deste m√™s vs m√™s passado"

**RELAT√ìRIOS (Export)**
Gerar e exportar relat√≥rios:
- "Gere relat√≥rio de receitas do trimestre"
- "Liste todos processos do cliente X"
- "Exportar timesheet de novembro"
- "Relat√≥rio de inadimpl√™ncia"
- "DRE do √∫ltimo trimestre"

**AGENDAMENTOS (Schedule)**
Criar lembretes e tarefas futuras:
- "Lembre-me de ligar para cliente Y amanh√£ √†s 10h"
- "Agendar follow-up com cliente Z daqui 7 dias"
- "Criar tarefa de revisar contrato at√© sexta"
- "Notifique-me quando processo X movimentar"

**NAVEGA√á√ÉO (Go to)**
Acessar diretamente telas:
- "Abra o processo #1234"
- "V√° para agenda de amanh√£"
- "Mostre perfil do cliente Jo√£o"
- "Abra relat√≥rio financeiro"

**3. √Årea de Resultados (Vers√°til)**

**A) Visualiza√ß√£o em Tabela**
Para listas e m√∫ltiplos registros:
- Colunas customiz√°veis
- Ordena√ß√£o por coluna
- Filtros r√°pidos
- A√ß√µes em linha
- Pagina√ß√£o
- Exporta√ß√£o CSV/Excel
- Sele√ß√£o m√∫ltipla

**B) Visualiza√ß√£o em Cards**
Para detalhes e informa√ß√µes ricas:
- Layout de cards responsivo
- Informa√ß√µes principais destacadas
- Bot√µes de a√ß√£o por card
- Badges de status
- Miniaturas de documentos

**C) Visualiza√ß√£o em Timeline**
Para hist√≥rico e sequ√™ncias:
- Linha do tempo cronol√≥gica
- Agrupamento por data
- √çcones por tipo de evento
- Expans√£o de detalhes
- Filtro por tipo

**D) Visualiza√ß√£o em Gr√°ficos**
Para an√°lises visuais:
- Barras horizontais/verticais
- Pizza/Donut
- Linhas (tend√™ncias)
- √Årea
- Sparklines
- Gauges

**E) Confirma√ß√£o de A√ß√£o**
Ap√≥s executar comandos:
- √çcone de sucesso/erro
- Resumo da a√ß√£o executada
- Dados principais alterados
- Bot√µes de a√ß√£o subsequente
- Link para visualizar objeto criado/editado

**4. Comandos R√°pidos (Favoritos)**

Sidebar com atalhos personaliz√°veis:

**Pr√©-configurados:**
- Minha agenda hoje
- Prazos desta semana
- Horas n√£o faturadas
- Publica√ß√µes pendentes
- Processos cr√≠ticos
- Inadimpl√™ncia atual
- Receita do m√™s

**Personaliz√°veis:**
- Usu√°rio cria seus pr√≥prios comandos
- Nome + comando + √≠cone
- Pode reordenar
- Compartilhar com equipe
- Categoriza√ß√£o

**5. Hist√≥rico de Comandos**

Painel lateral com hist√≥rico completo:
- Agrupado por data (Hoje, Ontem, Esta semana)
- Busca no hist√≥rico
- Favoritar comandos do hist√≥rico
- Reexecutar comando
- Ver resultado anterior
- Limpar hist√≥rico

**6. Entrada de Voz (Opcional)**

Bot√£o de microfone no input:
- Clica e fala naturalmente
- Transcri√ß√£o em tempo real
- IA processa comando falado
- Ideal para advogados ocupados
- Pode ditar longos comandos

### Intelig√™ncia da IA

**Entendimento Contextual**

A IA mant√©m contexto da conversa:

**Exemplo 1: Seguimento**
```
User: Mostre processos do cliente Jo√£o Silva
IA: [mostra 3 processos]

User: Fature horas do primeiro
IA: [entende que √© o processo #1234]
     ‚úì 8h faturadas - R$ 4.000

User: Agende audi√™ncia para o segundo na sexta √†s 14h
IA: [entende que √© o processo #5678]
     ‚úì Audi√™ncia agendada para 08/11 √†s 14h
```

**Exemplo 2: Corre√ß√£o Autom√°tica**
```
User: Mostra clientes inadeplentes
IA: Voc√™ quis dizer "inadimplentes"?
    Encontrei 3 clientes com pagamentos em atraso...
```

**Exemplo 3: Sugest√µes Proativas**
```
User: Registrar 3h no processo 1234
IA: ‚úì Registrado 3h no processo #1234
    
    üí° Voc√™ tem 15h n√£o faturadas neste processo
       (valor potencial: R$ 7.500).
       Deseja faturar agora? [Sim] [N√£o]
```

**Exemplo 4: Desambigua√ß√£o**
```
User: Abra o processo da Silva
IA: Encontrei 3 processos:
    1. Processo #1234 - Silva Ltda (Trabalhista)
    2. Processo #5678 - Maria Silva (C√≠vel)
    3. Processo #9012 - Jo√£o Silva (Tribut√°rio)
    
    Qual deseja abrir? Ou refine sua busca.
```

**Personalidade da IA**

Tom profissional mas amig√°vel:
- Sauda√ß√µes personalizadas
- Celebra conquistas
- Oferece dicas √∫teis
- Explica quando n√£o entende
- Pede confirma√ß√£o em a√ß√µes cr√≠ticas
- Usa emojis moderadamente (para contexto)

**Exemplo:**
```
User: Quanto recebi este m√™s?

IA: üí∞ √ìtima pergunta!
    
    Voc√™ recebeu R$ 32.500 em novembro.
    Isso representa 81% da sua meta mensal.
    
    Est√° faltando apenas R$ 7.500 para bater
    a meta de R$ 40.000. Continue assim! üöÄ
    
    [Ver Detalhes] [Gerar Relat√≥rio]
```

### Recursos Avan√ßados

**Multi-a√ß√£o em Um Comando**

```
User: Liste processos com prazo esta semana e crie lembretes para todos

IA: ‚úì Encontrei 5 processos com prazo
    ‚úì Criei 5 lembretes (1 dia antes de cada prazo)
    
    [Ver Processos] [Ver Lembretes]
```

**Compara√ß√µes e An√°lises Complexas**

```
User: Compare minha receita de outubro vs novembro por √°rea

IA: An√°lise comparativa Out/Nov:
    
    üìà Crescimento:
    ‚Ä¢ Tribut√°rio: +23% (R$ 12k ‚Üí R$ 15k)
    ‚Ä¢ C√≠vel: +12% (R$ 8k ‚Üí R$ 9k)
    
    üìâ Redu√ß√£o:
    ‚Ä¢ Trabalhista: -8% (R$ 10k ‚Üí R$ 9.2k)
    
    üí° Recomenda√ß√£o: Tribut√°rio est√° em alta.
       Considere alocar mais recursos nessa √°rea.
    
    [Ver Gr√°fico] [Relat√≥rio Detalhado]
```

**Workflows Complexos**

```
User: Para todos clientes inativos h√° mais de 90 dias, agende follow-up para pr√≥xima semana

IA: üîç Busquei clientes inativos...
    ‚úì Encontrei 8 clientes
    ‚úì Agendei 8 tarefas de follow-up
    
    Distribui√ß√£o:
    ‚Ä¢ Segunda: 2 follow-ups
    ‚Ä¢ Ter√ßa: 3 follow-ups  
    ‚Ä¢ Quarta: 3 follow-ups
    
    [Ver Clientes] [Ver Agenda]
```

### Integra√ß√£o com Outros M√≥dulos

**Transi√ß√£o Suave**

Quando IA sugere abrir outro m√≥dulo:
```
IA: [An√°lise completa]
    
    Deseja ver mais detalhes?
    [Abrir no M√≥dulo Processos] [Ficar Aqui]
```

**A√ß√µes que Impactam M√≥dulos**

Toda a√ß√£o executada no Centro de Comando reflete instantaneamente:
- Criar processo ‚Üí aparece no m√≥dulo Processos
- Registrar horas ‚Üí atualiza Timesheet no Financeiro
- Agendar compromisso ‚Üí adiciona na Agenda
- Faturar ‚Üí gera honor√°rio no Financeiro

**Feedback Visual**

Notifica√ß√£o toast confirma a√ß√£o:
"‚úì Processo #1234 atualizado com sucesso"

### Comandos por M√≥dulo

**Processos:**
- "Novos processos este m√™s"
- "Processos cr√≠ticos"
- "Movimenta√ß√µes de hoje"
- "Criar processo para cliente X"
- "Atualizar fase do processo Y"

**Clientes:**
- "Clientes ativos"
- "Novos clientes do trimestre"
- "Clientes sem contato h√° X dias"
- "Criar cliente: [dados]"
- "Ver hist√≥rico do cliente Z"

**Agenda:**
- "Minha agenda hoje/amanh√£/semana"
- "Audi√™ncias pendentes"
- "Prazos vencendo"
- "Agendar [tipo] com [quem] para [quando]"
- "Remarcar compromisso X"

**Financeiro:**
- "Receita do m√™s/ano"
- "Inadimpl√™ncia atual"
- "Faturar cliente/processo"
- "Registrar X horas no processo Y"
- "Gerar boleto para parcela Z"
- "Enviar cobran√ßa para cliente A"

**Publica√ß√µes:**
- "Publica√ß√µes n√£o lidas"
- "Publica√ß√µes urgentes"
- "Processar publica√ß√£o X"
- "Criar prazo da publica√ß√£o Y"

**Consultivo:**
- "Consultas em aberto"
- "Consultas atrasadas"
- "Criar consulta para cliente X"
- "Faturar horas da consulta Y"

**Documentos:**
- "Buscar documento [termo]"
- "Documentos do cliente X"
- "Documentos do processo Y"
- "Upload documento para processo Z"

**Relat√≥rios:**
- "DRE do m√™s/trimestre/ano"
- "Relat√≥rio de performance"
- "An√°lise de inadimpl√™ncia"
- "Receita por √°rea"
- "Timesheet do m√™s"

### Integra√ß√µes com IA

**Via Centro de Comando (√© o pr√≥prio m√≥dulo)**
- Qualquer comando natural
- Consultas complexas
- A√ß√µes em lote
- An√°lises personalizadas
- Relat√≥rios sob demanda

**Automa√ß√µes com n8n**
- Comandos agendados (executar X √†s Y horas)
- Comandos recorrentes (toda segunda √†s 9h)
- Alertas que geram comandos autom√°ticos
- Integra√ß√£o com webhooks externos

**Sugest√µes Proativas**
A IA pode iniciar conversa:
- "Bom dia! Voc√™ tem 3 compromissos hoje. Deseja revisar?"
- "Processo #1234 movimentou. Deseja visualizar?"
- "H√° 5 publica√ß√µes novas. Processar agora?"
- "Voc√™ bateu sua meta do m√™s! üéâ"

## Banco de Dados

### Tabelas Necess√°rias

**centro_comando_historico**
```
- id (uuid, PK)
- user_id (uuid, FK profiles)
- comando (text) - texto do comando
- comando_normalizado (text) - vers√£o limpa para busca
- intent (text) - inten√ß√£o identificada
- modulo_alvo (text, nullable) - qual m√≥dulo foi alvo
- contexto_anterior (jsonb, nullable) - contexto da conversa
- resultado (jsonb) - resultado da execu√ß√£o
- tipo_resultado (text) - 'lista', 'acao', 'analise', 'relatorio'
- sucesso (boolean)
- tempo_execucao_ms (integer)
- created_at (timestamp)
```

**centro_comando_favoritos**
```
- id (uuid, PK)
- user_id (uuid, FK profiles)
- nome (text) - nome do favorito
- comando (text) - comando a executar
- icone (text, nullable)
- categoria (text, nullable)
- ordem (integer)
- compartilhado_equipe (boolean) - se compartilha com escrit√≥rio
- uso_count (integer) - quantas vezes foi usado
- created_at (timestamp)
- updated_at (timestamp)
```

**centro_comando_cache**
```
- id (uuid, PK)
- comando_hash (text, unique) - hash do comando
- user_id (uuid, FK profiles, nullable) - null se cache global
- resultado (jsonb)
- created_at (timestamp)
- expires_at (timestamp)
```

**centro_comando_templates**
```
- id (uuid, PK)
- escritorio_id (uuid, FK)
- nome (text)
- descricao (text)
- comando_template (text) - com placeholders
- variaveis (jsonb) - lista de vari√°veis necess√°rias
- categoria (text)
- publico (boolean)
- criado_por (uuid, FK profiles)
- uso_count (integer)
- created_at (timestamp)
```

**centro_comando_sessoes**
```
- id (uuid, PK)
- user_id (uuid, FK profiles)
- inicio (timestamp)
- fim (timestamp, nullable)
- comandos_count (integer)
- contexto_sessao (jsonb) - mant√©m contexto da conversa
- ativo (boolean)
```

### Views

**v_comandos_frequentes**
```
Comandos mais utilizados por usu√°rio
Para sugest√µes e auto-complete
Ranking por frequ√™ncia
```

**v_comandos_recentes**
```
√öltimos 20 comandos do usu√°rio
Para hist√≥rico r√°pido
Ordenado por data DESC
```

### Functions

**processar_comando(user_id uuid, comando text, contexto jsonb)**
- Recebe comando em linguagem natural
- Identifica inten√ß√£o (intent)
- Extrai entidades (datas, nomes, valores)
- Determina m√≥dulo alvo
- Executa a√ß√£o apropriada
- Registra no hist√≥rico
- Retorna resultado estruturado

**manter_contexto_sessao(sessao_id uuid, novo_contexto jsonb)**
- Atualiza contexto da sess√£o
- Para comandos sequenciais
- Resolve refer√™ncias ("o primeiro", "esse", etc)
- TTL de 30 minutos de inatividade

**sugerir_comandos(user_id uuid, texto_parcial text)**
- Auto-complete inteligente
- Baseado em hist√≥rico
- Baseado em comandos populares
- Retorna lista de sugest√µes

**executar_acao(intent text, parametros jsonb)**
- Router para a√ß√µes espec√≠ficas
- Chama function apropriada do m√≥dulo alvo
- Valida permiss√µes
- Retorna resultado + feedback

**gerar_resposta_ia(comando text, resultado jsonb)**
- Formata resultado para linguagem natural
- Adiciona insights quando relevante
- Tom personalizado
- Retorna texto formatado

**favoritar_comando(user_id uuid, comando text, nome text)**
- Cria atalho favorito
- Retorna confirma√ß√£o

**buscar_historico(user_id uuid, filtros jsonb)**
- Busca no hist√≥rico com filtros
- Full-text search
- Filtro por data, m√≥dulo, sucesso
- Retorna resultados ordenados

### Triggers

**log_comando_executado**
- Ap√≥s execu√ß√£o bem-sucedida
- Registra em hist√≥rico
- Atualiza cache se aplic√°vel

**increment_uso_favorito**
- Quando favorito √© usado
- Incrementa uso_count
- Para ranking

**cleanup_sessao_inativa**
- Detecta sess√µes inativas > 30 min
- Marca como encerrada
- Limpa contexto tempor√°rio

### Scheduled Functions

**limpar_cache_expirado**
- Roda a cada hora
- Remove cache expirado
- Mant√©m apenas cache v√°lido

**agregar_comandos_populares**
- Roda diariamente
- Identifica comandos mais usados
- Para sugest√µes e templates

**backup_historico**
- Roda semanalmente
- Arquiva hist√≥rico antigo (> 90 dias)
- Mant√©m base limpa

### RLS

- Usu√°rios veem apenas pr√≥prio hist√≥rico
- Favoritos podem ser pessoais ou compartilhados com equipe
- Cache pode ser pessoal ou global
- Admins veem estat√≠sticas agregadas (n√£o comandos individuais)
